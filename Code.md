# Объяснение кода

## calibrate.py

### Импорты:
- **nvtx**: Используется для аннотирования кода для NVIDIA Tools Extension.
- **vio_ort**: Собственный модуль, содержащий класс `VIO` для обработки данных визуальной инерционной одометрии.
- **matplotlib.pyplot, plotly.graph_objects**: Построение графиков и анимаций.
- **cv2**: Работа с изображениями.
- **os, json**: Работа с файловой системой и JSON.
- **concurrent.futures, threading**: Многопоточность.
- **defaultdict**: Хранение статистики об ошибках.

### Основные функции:
1. **`register_error`**: Регистрирует ошибки, возникшие при обработке файлов.
2. **`process_file`**: Выполняет обработку одного JSON-файла:
   - Проверяет корректность структуры данных.
   - Загружает соответствующее изображение.
   - Обрабатывает данные VIO и GPS, обновляя глобальные списки координат.
3. **`main`**: Основная функция:
   - Создает пул потоков для параллельной обработки файлов.
   - Генерирует отчет об ошибках.
   - Сохраняет результаты в файл.
4. **`transform_vio_coords`**: Преобразует координаты VIO в GPS-пространство с использованием параметров трансформации.

### Результаты:
- Генерация файлов:
  - **`debug_points.txt`**: Содержит координаты GPS и VIO.
  - **`transformation_params.json`**: Параметры трансформации VIO в GPS.

### Визуализация:
- Построение 3D-графиков с разными углами обзора.
- Анимация маршрута дрона с использованием библиотеки `plotly`.

---

## vio_ort.py

### Импорты:
- **pymavlink**: Работа с MAVLink-сообщениями.
- **modules.xfeat_ort.XFeat**: Модуль для детекции и описания особенностей изображения.
- **nvtx**: Аннотация производительности.

### Основные классы и функции:
1. **`VIO`**:
   - Основной класс для обработки данных одометрии.
   - Методы:
     - **`add_trace_pt`**: Добавляет точку трассы, выполняет преобразования координат.
     - **`calc_pos`**: Расчет локальной позиции.
     - **`match_points_hom`**: Сопоставление точек между изображениями.
     - **`detect_and_compute`**: Обнаружение ключевых точек и расчет дескрипторов.
2. **Вспомогательные функции**:
   - **`calc_GPS_week_time`**: Рассчитывает текущее время в неделях GPS.
   - **`fetch_angles, fetch_height`**: Извлечение углов и высоты из сообщения.
   - **`extract_neighborhood`**: Извлечение области вокруг ключевой точки изображения.

### Камера:
- Загружаются параметры камеры из JSON.
- Создается маска камеры.

---

### 2. requirements.txt
Создайте файл с таким содержимым:

```
numpy
opencv-python
pillow
matplotlib
plotly
pymavlink
nvtx
```

---